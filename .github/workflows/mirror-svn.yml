name: Mirror from SourceForge

on:
  schedule:
    - cron: '0 2 * * *'  # 每天凌晨 2 點自動執行 (UTC時間)
  workflow_dispatch:      # 允許手動點擊按鈕觸發

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code and Mirror
        run: |
          # 1. 定義變數
          # SourceForge 的 clone 網址 (請替換成你的專案網址)
          SOURCE_URL="https://git.code.sf.net/p/iperf2/code"
          
          # 目標 GitHub 倉庫 (請替換成你的 GitHub 帳號/倉庫)
          TARGET_REPO="github.com/harrycheng1/iperf2-mirror.git"
          
          # 2. 建立臨時目錄並鏡像 Clone
          git clone --mirror "$SOURCE_URL" source-repo
          cd source-repo
          
          # 3. 設定推送目標 (使用 Token 進行驗證)
          git remote set-url --push origin "https://oauth2:${{ secrets.GH_PAT }}@$TARGET_REPO"
          
          # 4. 強制推送到 GitHub (鏡像模式，會覆蓋 GitHub 上的內容)
          git push --mirror